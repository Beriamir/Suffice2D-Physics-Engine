<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ray Casting into a Circle</title>
  <style>
    canvas {
      background: #111;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <canvas id="canvas" width="400" height="400"></canvas>
  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    const circle = {
      x: 300,
      y: 200,
      radius: 80
    };

    const ray = {
      origin: { x: 100, y: 100 },
      dir: { x: 1, y: 0.5 } // arbitrary direction
    };

    // Normalize direction
    const mag = Math.hypot(ray.dir.x, ray.dir.y);
    ray.dir.x /= mag;
    ray.dir.y /= mag;

    function drawCircle(c) {
      ctx.beginPath();
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 2;
      ctx.arc(c.x, c.y, c.radius, 0, Math.PI * 2);
      ctx.stroke();
    }

    function drawRay(ray) {
      const length = 1000;
      ctx.beginPath();
      ctx.strokeStyle = 'lime';
      ctx.moveTo(ray.origin.x, ray.origin.y);
      ctx.lineTo(ray.origin.x + ray.dir.x * length, ray.origin.y + ray.dir.y * length);
      ctx.stroke();
    }

    function drawPoint(x, y, color = 'red') {
      ctx.beginPath();
      ctx.fillStyle = color;
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fill();
    }

    function rayCircleIntersection(ray, circle) {
      const dx = ray.dir.x;
      const dy = ray.dir.y;

      const ox = ray.origin.x - circle.x;
      const oy = ray.origin.y - circle.y;

      const a = dx * dx + dy * dy;
      const b = 2 * (ox * dx + oy * dy);
      const c = ox * ox + oy * oy - circle.radius * circle.radius;

      const discriminant = b * b - 4 * a * c;

      if (discriminant < 0) {
        return []; // No intersection
      }

      const sqrtDisc = Math.sqrt(discriminant);
      const t1 = (-b - sqrtDisc) / (2 * a);
      const t2 = (-b + sqrtDisc) / (2 * a);

      const points = [];
      if (t1 >= 0) {
        points.push({
          x: ray.origin.x + t1 * dx,
          y: ray.origin.y + t1 * dy
        });
      }
      if (t2 >= 0 && t2 !== t1) {
        points.push({
          x: ray.origin.x + t2 * dx,
          y: ray.origin.y + t2 * dy
        });
      }
      return points;
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      drawCircle(circle);
      drawRay(ray);

      const hits = rayCircleIntersection(ray, circle);
      for (const pt of hits) {
        drawPoint(pt.x, pt.y, 'cyan');
      }

      drawPoint(ray.origin.x, ray.origin.y, 'yellow');
    }

    render();
  </script>
</body>
</html>